<UserControl
    d:DesignWidth="1000"
    mc:Ignorable="d"
    x:Class="Nitrox.Launcher.Views.SponsorView"
    x:DataType="vm:SponsorViewModel"
    xmlns="https://github.com/avaloniaui"
    xmlns:controls="clr-namespace:Nitrox.Launcher.Models.Controls"
    xmlns:converters="clr-namespace:Nitrox.Launcher.Models.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:Nitrox.Launcher.ViewModels"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:designer="clr-namespace:Nitrox.Launcher.ViewModels.Designer">
    <Design.DataContext>
        <designer:DesignSponsorViewModel />
    </Design.DataContext>
    
    <UserControl.Styles>
        <!-- ç»Ÿè®¡å¡ç‰‡æ ·å¼ -->
        <Style Selector="controls|FittingWrapPanel.stats-container">
            <Setter Property="Margin" Value="-8,0" />
            <Style Selector="^ > Border">
                <Setter Property="Background" Value="{DynamicResource BrandPanelBackground}" />
                <Setter Property="CornerRadius" Value="12" />
                <Setter Property="Padding" Value="22" />
                <Setter Property="Margin" Value="8" />
            </Style>
        </Style>
        
        <!-- èµžåŠ©è€…å¡ç‰‡æ ·å¼ -->
        <Style Selector="Border.sponsor-card">
            <Setter Property="Background" Value="{DynamicResource BrandPanelBackground}" />
            <Setter Property="CornerRadius" Value="16" />
            <Setter Property="Padding" Value="24" />
            <Setter Property="Margin" Value="8" />
            <Setter Property="BorderBrush" Value="#50FFFFFF" />
            <Setter Property="BorderThickness" Value="2" />
            <Style Selector="^:pointerover">
                <Setter Property="BorderBrush" Value="#4B9FE1" />
                <Setter Property="BoxShadow" Value="0 6 20 0 #00000020" />
            </Style>
        </Style>
    </UserControl.Styles>

    <ScrollViewer Classes="main">
        <StackPanel
            Background="{DynamicResource BrandWhite}"
            Classes="viewPadding"
            Spacing="23">
            
            <!-- é¡µé¢æ ‡é¢˜ -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Classes="header" Text="èµžåŠ©æ”¯æŒ" />
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="12">
                    <Button Command="{Binding RefreshSponsorsCommand}"
                            IsEnabled="{Binding !IsLoading}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="ðŸ”„" VerticalAlignment="Center"/>
                            <TextBlock Text="åˆ·æ–°" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <Button Command="{Binding BecomeSponsorCommand}" Classes="primary">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <TextBlock Text="â¤ï¸" VerticalAlignment="Center"/>
                            <TextBlock Text="æˆä¸ºèµžåŠ©è€…" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Banner -->
            <Image MaxWidth="1580" Source="/Assets/Images/banners/community.png" />

            <!-- ç»Ÿè®¡ä¿¡æ¯ -->
            <controls:FittingWrapPanel Classes="stats-container" MaxWidth="2500" MinItemWidth="280">
                <Border>
                    <StackPanel Spacing="10" HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ’°" FontSize="48" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding TotalSponsorAmount, StringFormat='Â¥{0:F0}'}" 
                                   FontSize="32" FontWeight="Bold" HorizontalAlignment="Center"/>
                        <TextBlock Text="æ€»èµžåŠ©é‡‘é¢" FontSize="16" Opacity="0.7" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
                
                <Border>
                    <StackPanel Spacing="10" HorizontalAlignment="Center">
                        <TextBlock Text="ðŸ‘¥" FontSize="48" HorizontalAlignment="Center"/>
                        <TextBlock Text="{Binding SponsorCount}" 
                                   FontSize="32" FontWeight="Bold" HorizontalAlignment="Center"/>
                        <TextBlock Text="èµžåŠ©è€…æ•°é‡" FontSize="16" Opacity="0.7" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </controls:FittingWrapPanel>

            <!-- åŠ è½½çŠ¶æ€ -->
            <Border Background="{DynamicResource BrandPanelBackground}"
                    CornerRadius="12" 
                    Padding="20"
                    IsVisible="{Binding IsLoading}"
                    HorizontalAlignment="Center">
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <TextBlock Text="â³" FontSize="20"/>
                    <TextBlock Text="æ­£åœ¨åŠ è½½èµžåŠ©è€…æ•°æ®..." FontSize="16"/>
                </StackPanel>
            </Border>

            <!-- èµžåŠ©è€…åˆ—è¡¨ -->
            <StackPanel IsVisible="{Binding !IsLoading}" Spacing="20">
                <TextBlock Text="èµžåŠ©è€…åå•" FontSize="28" FontWeight="Bold"/>
                
                <ItemsControl ItemsSource="{Binding Sponsors}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <controls:FittingWrapPanel MaxWidth="2500" MinItemWidth="380" Margin="-8,0" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Classes="sponsor-card">
                                <StackPanel Spacing="16">
                                    <!-- å¤´åƒå’Œå§“ååŒºåŸŸ -->
                                    <Grid ColumnDefinitions="Auto,*">
                                        <Border Grid.Column="0" 
                                               CornerRadius="32"
                                               Width="64"
                                               Height="64"
                                               ClipToBounds="True">
                                            <Grid>
                                                <Image Source="{Binding AvatarBitmap}"
                                                       IsVisible="{Binding HasAvatarImage}"
                                                       Stretch="UniformToFill"/>
                                                <Border Background="#4B9FE1"
                                                       IsVisible="{Binding !HasAvatarImage}">
                                                    <TextBlock Text="{Binding AvatarText}" 
                                                              FontSize="24"
                                                              FontWeight="Bold"
                                                              Foreground="White"
                                                              HorizontalAlignment="Center"
                                                              VerticalAlignment="Center"/>
                                                </Border>
                                            </Grid>
                                        </Border>
                                        
                                        <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center" Spacing="6">
                                            <TextBlock Text="{Binding Name}" 
                                                      FontSize="18" 
                                                      FontWeight="Bold"
                                                      TextWrapping="Wrap"
                                                      MaxWidth="270"/>
                                            <TextBlock Text="{Binding FormattedAmount}" 
                                                       FontSize="16" 
                                                       Foreground="#4B9FE1"
                                                       FontWeight="SemiBold"/>
                                        </StackPanel>
                                    </Grid>
                                    
                                    <!-- åˆ†éš”çº¿ -->
                                    <Border Height="1" 
                                           Background="#20FFFFFF" 
                                           Margin="0,16,0,0"/>
                                    
                                    <!-- æ ‡ç­¾å’Œå¥—é¤ -->
                                    <StackPanel Orientation="Horizontal" Spacing="10">
                                        <Border Background="#4B9FE1" 
                                               CornerRadius="6" 
                                               Padding="8,4"
                                               IsVisible="{Binding IsFromApi}">
                                            <TextBlock Text="{Binding SourceBadge}" 
                                                      FontSize="11" 
                                                      FontWeight="Bold"
                                                      Foreground="White"/>
                                        </Border>
                                        <Border Background="#FFD700" 
                                               CornerRadius="6" 
                                               Padding="8,4"
                                               IsVisible="{Binding PlanName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                                            <TextBlock Text="{Binding PlanName}" 
                                                      FontSize="11" 
                                                      FontWeight="Bold"
                                                      Foreground="#000000"/>
                                        </Border>
                                    </StackPanel>
                                    
                                    <!-- æ—¥æœŸ -->
                                    <TextBlock Text="{Binding FormattedDate}" 
                                               FontSize="12" 
                                               Opacity="0.5"
                                               Margin="0,0,0,0"/>
                                    
                                    <!-- ç•™è¨€å†…å®¹ -->
                                    <TextBlock Text="{Binding Message}" 
                                               FontSize="14" 
                                               TextWrapping="Wrap"
                                               Opacity="0.8"
                                               LineHeight="20"/>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>

            <!-- æ„Ÿè°¢ä¿¡æ¯ -->
            <Border Background="{DynamicResource BrandPanelBackground}"
                    CornerRadius="12" 
                    Padding="40"
                    MaxWidth="1580">
                <StackPanel Spacing="16" HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ™" FontSize="48" HorizontalAlignment="Center"/>
                    <TextBlock Text="æ„Ÿè°¢æ‚¨çš„æ”¯æŒ" 
                               FontSize="24" 
                               FontWeight="Bold" 
                               HorizontalAlignment="Center"/>
                    <TextBlock Text="æ¯ä¸€ä»½èµžåŠ©éƒ½æ˜¯å¯¹ Nitrox é¡¹ç›®çš„è®¤å¯å’Œæ”¯æŒï¼Œè®©æˆ‘ä»¬æœ‰åŠ¨åŠ›æŒç»­æ”¹è¿›å’Œç»´æŠ¤è¿™ä¸ªå¼€æºé¡¹ç›®ã€‚" 
                               FontSize="16" 
                               TextWrapping="Wrap"
                               TextAlignment="Center"
                               Opacity="0.8"
                               MaxWidth="600"/>
                    <TextBlock Text="æ‚¨çš„èµžåŠ©å°†ç”¨äºŽï¼šæœåŠ¡å™¨ç»´æŠ¤ã€å¼€å‘å·¥å…·è´­ä¹°ã€ç¤¾åŒºæ´»åŠ¨ä¸¾åŠžç­‰" 
                               FontSize="14" 
                               TextAlignment="Center"
                               Opacity="0.6"/>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</UserControl>
