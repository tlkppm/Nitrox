# Nitrox v2.4.1.0 å…³é”®Bugä¿®å¤ç‰ˆæœ¬å‘å¸ƒ ğŸ› ï¸

## ğŸ“… å‘å¸ƒæ—¥æœŸ
2025å¹´10æœˆ20æ—¥

## ğŸ¯ ç‰ˆæœ¬æ¦‚è¿°
æœ¬æ¬¡æ›´æ–°åŒæ­¥äº†å®˜æ–¹Nitroxä»“åº“çš„PR #2535å’Œ#2541ï¼Œä¿®å¤äº†å¤šä¸ªä¸¥é‡å½±å“æ¸¸æˆä½“éªŒçš„å…³é”®Bugï¼ŒåŒ…æ‹¬å»ºé€ ç³»ç»Ÿã€å®ä½“ç”Ÿæˆå’Œè½½å…·ç‰©ç†é—®é¢˜ã€‚

---

## âœ… ä¸»è¦ä¿®å¤å†…å®¹

### 1. **å»ºé€ ç³»ç»Ÿä¿®å¤** (PR #2535)
**é—®é¢˜æè¿°ï¼š** å»ºé€ ç‰©é”€æ¯æ—¶ï¼ŒèŠ‚æµå™¨é€»è¾‘é”™è¯¯å¯¼è‡´é”€æ¯åŒ…ï¼ˆamount = 0ï¼‰æ— æ³•æ­£ç¡®å‘é€

**å½±å“ï¼š** 
- å­˜å‚¨æŸœ/æ¨¡å—åœ¨æ‹†é™¤åä»ç„¶å­˜åœ¨
- æ¯æ¬¡è¿›å…¥å­˜æ¡£éƒ½ä¼šçœ‹åˆ°ä¹‹å‰å·²åˆ é™¤çš„å»ºç­‘ç‰©é‡å¤å‡ºç°
- å»ºé€ ç‰©çŠ¶æ€åœ¨å¤šäººæ¸¸æˆä¸­ä¸åŒæ­¥

**ä¿®å¤è¯¦æƒ…ï¼š**
```csharp
// ä¿®å¤å‰ï¼šå…ˆå‘é€èŠ‚æµåŒ…ï¼Œå†æ¸…ç†ï¼ˆå¯¼è‡´ amount=0 çš„åŒ…è¢«èŠ‚æµå™¨åæ‰ï¼‰
Resolve<ThrottledPacketSender>().SendThrottled(new ModifyConstructedAmount(entityId, amount), ...);
if (amount == 0) {
    Resolve<ThrottledPacketSender>().RemovePendingPackets(entityId);
}

// ä¿®å¤åï¼šæ£€æµ‹åˆ° amount=0 æ—¶ï¼Œç«‹å³æ¸…ç†å¹¶ç›´æ¥å‘é€
if (amount == 0f) {
    Resolve<ThrottledPacketSender>().RemovePendingPackets(entityId);
    Resolve<IPacketSender>().Send(modifyConstructedAmount);
    return;
}
```

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `NitroxPatcher/Patches/Dynamic/Constructable_Construct_Patch.cs`

---

### 2. **å®ä½“ç”Ÿæˆä¿®å¤** (PR #2541)
**é—®é¢˜æè¿°ï¼š** æœåŠ¡å™¨ä¸å‘é€ç©ºå•å…ƒæ ¼ä¿¡æ¯ï¼Œå¯¼è‡´å®¢æˆ·ç«¯æ— æ³•æ­£ç¡®æ ‡è®°å•å…ƒæ ¼ä¸ºå·²åŠ è½½

**å½±å“ï¼š**
- æ³¡æ³¡é±¼ç­‰ç”Ÿç‰©å¼‚å¸¸èšé›†ã€é‡å¤ç”Ÿæˆ
- å®ä½“åœ¨åŒä¸€åŒºåŸŸåå¤å‡ºç°
- åœ°å½¢åŠ è½½çŠ¶æ€ä¸ä¸€è‡´

**ä¿®å¤è¯¦æƒ…ï¼š**
```csharp
// æœåŠ¡å™¨ç«¯ï¼šç°åœ¨æ€»æ˜¯å‘é€å•å…ƒæ ¼ä¿¡æ¯ï¼Œå³ä½¿æ˜¯ç©ºå•å…ƒæ ¼
// We send this data whether or not it's empty because the client needs to know about it (see Terrain)
player.SendPacket(new SpawnEntities(totalEntities, packet.Added, true));

// å®¢æˆ·ç«¯ï¼šå¤„ç†ç©ºå•å…ƒæ ¼ï¼Œæ ‡è®°ä¸ºå®Œå…¨ç”Ÿæˆ
if (packet.Entities.Count > 0) {
    entities.EnqueueEntitiesToSpawn(packet.Entities, packet.SpawnedCells, packet.ForceRespawn);
    return;
}

// Even if there was nothing to be spawned in the cell, we need to know about it as fully spawned
foreach (AbsoluteEntityCell spawnedEntityCell in packet.SpawnedCells) {
    terrain.AddFullySpawnedCell(spawnedEntityCell);
}
```

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `NitroxServer/Communication/Packets/Processors/CellVisibilityChangedProcessor.cs`
- `NitroxClient/Communication/Packets/Processors/SpawnEntitiesProcessor.cs`
- `NitroxClient/GameLogic/Terrain.cs`
- `NitroxClient/GameLogic/Entities.cs`
- `NitroxModel/Packets/SpawnEntities.cs`ï¼ˆæ–°å¢ `SpawnedCells` å±æ€§ï¼‰

---

### 3. **è½½å…·ç‰©ç†ä¿®å¤** (PR #2541)
**é—®é¢˜æè¿°ï¼š** å¤–éª¨éª¼å’Œæµ·è›¾ç”Ÿæˆåä¼šè‡ªç”±è½ä½“ç©¿è¿‡åœ°å½¢

**å½±å“ï¼š**
- è½½å…·ç”Ÿæˆåå¼‚å¸¸å è½
- è½½å…·å¡åœ¨åœ°å½¢å†…æˆ–æ‰åˆ°åœ°å›¾ä¸‹æ–¹
- è½½å…·æ— æ³•æ­£å¸¸ä½¿ç”¨

**ä¿®å¤è¯¦æƒ…ï¼š**
```csharp
// åœ¨è½½å…·ç”Ÿæˆåï¼Œå…³é—­æ„é€ å™¨è‡ªç”±è½ä½“è¦†ç›–
if (gameObject.TryGetComponent(out vehicle)) {
    vehicle.constructionFallOverride = false;
}
```

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `NitroxClient/GameLogic/Spawning/WorldEntities/VehicleEntitySpawner.cs`

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åŒ…åè®®æ›´æ–°
`SpawnEntities` åŒ…æ–°å¢ `SpawnedCells` å±æ€§ï¼š
```csharp
public AbsoluteEntityCell[] SpawnedCells { get; }
```

### Terrain ç±»å¢å¼º
æ–°å¢æ–¹æ³•ç”¨äºè·Ÿè¸ªå®Œå…¨ç”Ÿæˆçš„å•å…ƒæ ¼ï¼š
```csharp
public void AddFullySpawnedCell(AbsoluteEntityCell cell)
```

### æ„é€ å‡½æ•°ç­¾åæ›´æ–°
```csharp
// SpawnEntities åŒ…
public SpawnEntities(List<Entity> entities, AbsoluteEntityCell[] spawnedCells, bool forceRespawn = false)

// Entities.EnqueueEntitiesToSpawn
public void EnqueueEntitiesToSpawn(List<Entity> entitiesToEnqueue, AbsoluteEntityCell[] spawnedCells, bool coldStart = false)
```

---

## ğŸ“Š ä¿®æ”¹ç»Ÿè®¡

### æ–‡ä»¶ä¿®æ”¹æ¸…å•
| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹ç±»å‹ | è¯´æ˜ |
|---------|---------|------|
| `Constructable_Construct_Patch.cs` | é€»è¾‘ä¿®å¤ | å»ºé€ ç‰©é”€æ¯åŒ…å‘é€é¡ºåº |
| `CellVisibilityChangedProcessor.cs` | é€»è¾‘ä¿®å¤ | æ€»æ˜¯å‘é€å•å…ƒæ ¼ä¿¡æ¯ |
| `SpawnEntitiesProcessor.cs` | åŠŸèƒ½å¢å¼º | å¤„ç†ç©ºå•å…ƒæ ¼ |
| `VehicleEntitySpawner.cs` | Bugä¿®å¤ | ç¦ç”¨æ„é€ å™¨è‡ªç”±è½ä½“ |
| `Terrain.cs` | åŠŸèƒ½å¢å¼º | è·Ÿè¸ªå®Œå…¨ç”Ÿæˆçš„å•å…ƒæ ¼ |
| `Entities.cs` | ç­¾åæ›´æ–° | æ”¯æŒå•å…ƒæ ¼ä¿¡æ¯ä¼ é€’ |
| `SpawnEntities.cs` | åè®®æ‰©å±• | æ–°å¢ SpawnedCells å±æ€§ |
| `Directory.Build.props` | ç‰ˆæœ¬æ›´æ–° | 2.4.0.0 â†’ 2.4.1.0 |
| `AnnouncementService.cs` | å†…å®¹æ›´æ–° | æ·»åŠ v2.4.1.0å…¬å‘Š |

### ä»£ç è¡Œæ•°ç»Ÿè®¡
- **æ€»ä¿®æ”¹æ–‡ä»¶æ•°ï¼š** 9
- **æ–°å¢ä»£ç è¡Œæ•°ï¼š** ~50
- **ä¿®æ”¹ä»£ç è¡Œæ•°ï¼š** ~30
- **å½±å“èŒƒå›´ï¼š** å»ºé€ ç³»ç»Ÿã€å®ä½“ç”Ÿæˆã€è½½å…·ç‰©ç†ã€åŒ…åè®®

---

## ğŸ® ç©å®¶å½±å“

### ä¿®å¤å‰çš„å¸¸è§é—®é¢˜
1. âŒ æ‹†é™¤çš„å­˜å‚¨æŸœ/å»ºç­‘ç‰©é‡å¤å‡ºç°
2. âŒ æ³¡æ³¡é±¼ç­‰ç”Ÿç‰©å¼‚å¸¸å¤§é‡èšé›†
3. âŒ å¤–éª¨éª¼/æµ·è›¾ç”Ÿæˆåæ‰è½ç©¿åœ°
4. âŒ å»ºç­‘ç‰©çŠ¶æ€å¤šäººæ¸¸æˆä¸åŒæ­¥
5. âŒ å®ä½“åœ¨åŒä¸€ä½ç½®é‡å¤ç”Ÿæˆ

### ä¿®å¤åçš„æ”¹è¿›
1. âœ… å»ºç­‘ç‰©æ‹†é™¤æ­£ç¡®åŒæ­¥
2. âœ… ç”Ÿç‰©ç”Ÿæˆæ•°é‡æ­£å¸¸
3. âœ… è½½å…·ç”Ÿæˆä½ç½®ç¨³å®š
4. âœ… å¤šäººæ¸¸æˆçŠ¶æ€ä¸€è‡´
5. âœ… å®ä½“ç”Ÿæˆæœºåˆ¶å¯é 

---

## ğŸ”— ç›¸å…³èµ„æº

### å®˜æ–¹PRé“¾æ¥
- **PR #2535:** https://github.com/SubnauticaNitrox/Nitrox/pull/2535  
  æ ‡é¢˜ï¼šFix ghost/module destruction not being broadcasted
  
- **PR #2541:** https://github.com/SubnauticaNitrox/Nitrox/pull/2541  
  æ ‡é¢˜ï¼šFix exosuits falling through the ground

### ç¼–è¯‘çŠ¶æ€
- âœ… Release ç¼–è¯‘æˆåŠŸ
- âœ… æ— é”™è¯¯
- âš ï¸ 77ä¸ªè­¦å‘Šï¼ˆå‡ä¸ºä»£ç è´¨é‡æç¤ºï¼Œä¸å½±å“åŠŸèƒ½ï¼‰

---

## ğŸ’¡ å‡çº§å»ºè®®

### ç´§æ€¥ç¨‹åº¦
ğŸ”´ **å¼ºçƒˆå»ºè®®ç«‹å³æ›´æ–°**

### å…¼å®¹æ€§
- âœ… ä¸v2.4.0.0å®Œå…¨å…¼å®¹
- âœ… ä¿å­˜æ–‡ä»¶å‘åå…¼å®¹
- âœ… æœåŠ¡å™¨é…ç½®æ— éœ€è°ƒæ•´

### æ›´æ–°æ­¥éª¤
1. å…³é—­æ¸¸æˆå’ŒæœåŠ¡å™¨
2. ä½¿ç”¨å¯åŠ¨å™¨æ›´æ–°åˆ°v2.4.1.0
3. é‡æ–°å¯åŠ¨æœåŠ¡å™¨
4. è¿›å…¥æ¸¸æˆæµ‹è¯•

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹è´¡çŒ®è€…ï¼š
- **tornac1234** - PR #2535 å’Œ #2541 çš„ä½œè€…
- **Measurity & dartasen** - ä»£ç å®¡æŸ¥å’Œåˆå¹¶
- **SubnauticaNitroxå›¢é˜Ÿ** - æŒç»­ç»´æŠ¤å’Œæ”¹è¿›

---

## ğŸ“ åè®°

æœ¬æ¬¡æ›´æ–°è§£å†³äº†è‡ªv2.4.0.0ä»¥æ¥ç¤¾åŒºåé¦ˆæœ€å¤šçš„ä¸‰ä¸ªé—®é¢˜ï¼š
1. å­˜å‚¨æŸœé‡å¤å‡ºç°
2. æ³¡æ³¡é±¼åˆ·æ–°å¼‚å¸¸
3. è½½å…·ç©¿åœ°

è¿™äº›ä¿®å¤å¤§å¹…æå‡äº†å¤šäººæ¸¸æˆçš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§ï¼Œä¸ºç©å®¶å¸¦æ¥æ›´æµç•…çš„æ¸¸æˆä½“éªŒã€‚

---

**å‘å¸ƒæ¸ é“ï¼š** GitHub Release | Steamåˆ›æ„å·¥åŠ | Bç«™åŠ¨æ€  
**æŠ€æœ¯æ”¯æŒï¼š** GitHub Issues | Discordç¤¾åŒº  
**ä¸‹æ¬¡æ›´æ–°é¢„å‘Šï¼š** æŒç»­åŒæ­¥å®˜æ–¹ä»“åº“æ”¹è¿›

